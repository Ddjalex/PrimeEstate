RewriteEngine On

# Enable CORS
Header always set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"

# Handle preflight OPTIONS requests
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

# API Routes
RewriteCond %{REQUEST_URI} ^/api/properties/?$
RewriteRule ^api/properties/?$ api/properties.php [L]

RewriteCond %{REQUEST_URI} ^/api/properties/([^/]+)/?$
RewriteRule ^api/properties/([^/]+)/?$ api/properties.php?id=$1 [L]

RewriteCond %{REQUEST_URI} ^/api/slider/?$
RewriteRule ^api/slider/?$ api/slider.php [L]

RewriteCond %{REQUEST_URI} ^/api/slider/([^/]+)/?$
RewriteRule ^api/slider/([^/]+)/?$ api/slider.php?id=$1 [L]

RewriteCond %{REQUEST_URI} ^/api/auth/?$
RewriteRule ^api/auth/?$ api/auth.php [L]

RewriteCond %{REQUEST_URI} ^/api/auth/login/?$
RewriteRule ^api/auth/login/?$ api/auth.php?action=login [L]

RewriteCond %{REQUEST_URI} ^/api/auth/logout/?$
RewriteRule ^api/auth/logout/?$ api/auth.php?action=logout [L]

RewriteCond %{REQUEST_URI} ^/api/upload/?$
RewriteRule ^api/upload/?$ api/upload.php [L]

RewriteCond %{REQUEST_URI} ^/api/contact/?$
RewriteRule ^api/contact/?$ api/contact.php [L]

RewriteCond %{REQUEST_URI} ^/api/whatsapp/settings/?$
RewriteRule ^api/whatsapp/settings/?$ api/settings.php?type=whatsapp [L]

RewriteCond %{REQUEST_URI} ^/api/contact/settings/?$
RewriteRule ^api/contact/settings/?$ api/settings.php?type=contact [L]

# Serve uploaded files
RewriteCond %{REQUEST_URI} ^/uploads/
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^(.*)$ - [L]

# Frontend routing - serve index.html for all other requests
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/api/
RewriteCond %{REQUEST_URI} !^/uploads/
RewriteRule . index.html [L]

# Security headers
Header always set X-Frame-Options DENY
Header always set X-Content-Type-Options nosniff
Header always set X-XSS-Protection "1; mode=block"

# Cache static assets
<IfModule mod_expires.c>
    ExpiresActive on
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
</IfModule>