RewriteEngine On

# Enable Node.js for .js files
AddHandler application/x-httpd-nodejs .js

# Handle API routes to server.js
RewriteCond %{REQUEST_URI} ^/api/.*
RewriteRule ^(.*)$ server.js [L]

# Serve static uploads
RewriteCond %{REQUEST_URI} ^/uploads/.*
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^(.*)$ - [L]

# Handle client-side routing for React app
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/api/.*
RewriteCond %{REQUEST_URI} !^/uploads/.*
RewriteRule . /public/index.html [L]

# CORS headers
Header always set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"

# Cache static assets
<IfModule mod_expires.c>
    ExpiresActive on
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
</IfModule>